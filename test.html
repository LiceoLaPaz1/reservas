<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Test Reserva</title>
</head>
<body>
  <h1>Formulario de Prueba</h1>
  <form id="formulario">
    <label>Nombre: <input type="text" name="nombre" required></label><br>
    <label>Apellido: <input type="text" name="apellido" required></label><br>
    <label>Fecha: <input type="date" name="fecha" required></label><br>
    <label>Turno:
      <select name="turno">
        <option value="matutino">Matutino</option>
        <option value="vespertino">Vespertino</option>
      </select>
    </label><br>
    <label>Hora: <input type="text" name="hora" value="1era"></label><br>
    <label>Recurso: <input type="text" name="recurso" value="Cañón"></label><br>
    <button type="submit">Enviar</button>
  </form>

  <script>
    const form = document.getElementById("formulario");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const datos = {
        id: Date.now(),
        nombre: form.nombre.value,
        apellido: form.apellido.value,
        fecha: form.fecha.value,
        turno: form.turno.value,
        hora: form.hora.value,
        recurso: form.recurso.value,
        fechaReserva: new Date().toISOString()
      };

      const endpoint = "https://script.google.com/macros/s/AKfycbxyPc9vCMNYKI7zQTXLWb-3BuuNgwnK8EY4cI-2581r_BRJvtnxKPDQgtIyvf9TKZHrag/exec";

      const payload = new URLSearchParams({
        data: JSON.stringify(datos)
      });

    fetch(endpoint, {
  method: "POST",
  body: payload
})
  .then(async response => {
    const text = await response.text();
    try {
      const data = JSON.parse(text);
      console.log("Respuesta del servidor (parseada):", data);
      if (data.status === "success") {
        alert("✅ ¡Reserva registrada con éxito!");
      } else {
        alert("⚠️ Error del servidor: " + data.message);
      }
    } catch (e) {
      console.error("❌ Respuesta no JSON:", text);
      alert("❌ El servidor devolvió una respuesta inesperada:\n" + text);
    }
  })
  .catch(error => {
    console.error("❌ Error en fetch:", error);
    alert("❌ Error al conectar con el servidor.");
  });

    });
  </script>
</body>
</html>

